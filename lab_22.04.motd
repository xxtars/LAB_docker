#!/bin/bash

printf "+--------------------------------------------------YourLAB--------------------------------------------------------+
"
printf "[32mç›®å½•è¯´æ˜Ž:[0m
"
printf "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•¦â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
"
printf "â•‘ç›®å½•             â•‘åç§°  â•‘é€Ÿåº¦â•‘è¯´æ˜Ž                                                                     â•‘
"
printf "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
"
printf "â•‘/                â•‘ç³»ç»Ÿç›˜â•‘å›ºæ€â•‘å®žä¾‹å…³æœºæ•°æ®ä¼šä¸¢å¤±ã€‚                                                     â•‘
"
printf "â•‘(åŒ…æ‹¬/root)      â•‘      â•‘    â•‘\033[1;31mæ•°æ®ç›˜å¤–æ‰€æœ‰å‡ä¼šè¢«dockerå¤‡ä»½ï¼Œå ç”¨ç³»ç»Ÿç›˜ï¼Œæ‰€ä»¥æ•°æ®ç›˜å¤–ç¦æ­¢å­˜æ”¾æ•°æ®ï¼\033[0m     â•‘
"
printf "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
"
printf "â•‘/root/media_hhd  â•‘æ•°æ®ç›˜â•‘æœºæ¢°â•‘å®žä¾‹å…³æœºæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¯å­˜æ”¾ä»£ç å’Œæ•°æ®ã€‚å¯ä»¥åœ¨dockerå¤–æ‰¾åˆ°å®žé™…è·¯å¾„ã€‚     â•‘
"
printf "â•‘/root/media_ssd  â•‘æ•°æ®ç›˜â•‘å›ºæ€â•‘å®žä¾‹å…³æœºæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¯å­˜æ”¾ä»£ç å’Œæ•°æ®ã€‚å¯ä»¥åœ¨dockerå¤–æ‰¾åˆ°å®žé™…è·¯å¾„ã€‚     â•‘
"
if test -d /root/YourLAB-nas ; then
  printf "â•‘/root/YourLAB-nas â•‘ç½‘ç›˜  â•‘æ…¢  â•‘å¯ä»¥å®žçŽ°å¤šå®žä¾‹é—´çš„æ–‡ä»¶åŒæ­¥å…±äº«ï¼Œä¸å—å®žä¾‹å¼€å…³æœºå’Œä¿å­˜é•œåƒçš„å½±å“ã€‚         â•‘
"
fi
printf "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•©â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"

cfs_us=($(cat /sys/fs/cgroup/cpu.max))

cfs_quota_us=${cfs_us[0]}
cfs_period_us=${cfs_us[1]}
if [ $cfs_quota_us -ge $cfs_period_us ];then
    cores=$((cfs_quota_us / cfs_period_us))
else
    cores=0.$((cfs_quota_us * 10 / cfs_period_us))
fi

if [ $cfs_quota_us -eq -1 ];then
printf "[32mCPU[0m ï¼š%s æ ¸å¿ƒ
" "$(nproc)"
else
printf "[32mCPU[0m ï¼š%s æ ¸å¿ƒ
" "${cores}"
fi



limit_in_bytes=$(cat /sys/fs/cgroup/memory.max)
memory="$((limit_in_bytes / 1024 / 1024 / 1024)) GB"
printf "[32må†…å­˜[0mï¼š%s
" "${memory}"

if type nvidia-smi >/dev/null 2>&1; then
  gpu=$(nvidia-smi -i 0 --query-gpu=name,count --format=csv,noheader)
  printf "[32mGPU [0mï¼š%s
" "${gpu}"
fi

printf "[32må­˜å‚¨[0mï¼š
"
disk=$(df -ah | grep "/$" | awk '{print $5" "$3"/"$2}')
printf "[32m  ç³»ç»Ÿç›˜/          [0mï¼š%s
" "${disk}"

if test -d /root/media_ssd ; then
  disk=$(df -ah | grep "media_ssd" | awk '{print $5" "$3"/"$2}')
  printf "[32m  æ•°æ®ç›˜/root/media_ssd [0mï¼š%s
" "${disk}"
fi

if test -d /root/media_hhd ; then
  disk=$(df -ah | grep "media_hhd"| awk '{print $5" "$3"/"$2}')
  printf "[32m  æ•°æ®ç›˜/root/media_hhd [0mï¼š%s
" "${disk}"
fi

if test -d /root/YourLAB-nas ; then
  disk=$(df -ah | grep "YourLAB-nas" | awk '{print $5" "$3"/"$2}')
  printf "[32m  ç½‘  ç›˜/root/YourLAB-nas[0mï¼š%s
" "${disk}"
fi
printf "+----------------------------------------------------------------------------------------------------------------+
"
printf "[31m*æ³¨æ„: [0m
"
printf "[31m1.ç³»ç»Ÿç›˜è¾ƒå°è¯·å°†å¤§çš„æ•°æ®å­˜æ”¾äºŽæ•°æ®ç›˜æˆ–ç½‘ç›˜ä¸­ï¼Œé‡ç½®ç³»ç»Ÿæ—¶æ•°æ®ç›˜å’Œç½‘ç›˜ä¸­çš„æ•°æ®ä¸å—å½±å“[0m
"
# printf "[31m2.æ¸…ç†ç³»ç»Ÿç›˜è¯·å‚è€ƒï¼šhttps://www.autodl.com/docs/qa/[0m
# "


# result=$(echo $gpu | grep "A4000")
# bashrc=`cat /etc/profile`
# if [[ "$result" != "" ]]; then
#     if [[ "$bashrc" =~ "NCCL_P2P_DISABLE" ]]; then
#         :
#     else
#         echo "export NCCL_P2P_DISABLE=1" >> /etc/profile
#         source /etc/profile
#     fi
# fi
# result=$(echo $gpu | grep "A5000")
# if [[ "$result" != "" ]]; then
#     if [[ "$bashrc" =~ "NCCL_P2P_DISABLE" ]]; then
#         :
#     else
#         echo "export NCCL_P2P_DISABLE=1" >> /etc/profile
#         source /etc/profile
#     fi
# fi

# alias sudo=""

